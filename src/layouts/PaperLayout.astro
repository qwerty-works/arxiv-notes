---
import BaseLayout from './BaseLayout.astro';
import type { CollectionEntry } from 'astro:content';

const { entry, prev, next, related } = Astro.props as {
  entry: CollectionEntry<'papers'>;
  prev: CollectionEntry<'papers'> | null;
  next: CollectionEntry<'papers'> | null;
  related: CollectionEntry<'papers'>[];
};

const fm = entry.data;
const title = `${fm.catchyTitle} â€” arxiv-notes`;
const description = fm.blurb;

const BASE = import.meta.env.BASE_URL.endsWith('/')
  ? import.meta.env.BASE_URL
  : `${import.meta.env.BASE_URL}/`;
function href(path: string) {
  return `${BASE}${path.replace(/^\/+/, '')}`;
}

const canonical = `${fm.arxivId}/${entry.slug.split('/').slice(1).join('/')}/`;
---

<BaseLayout title={title} description={description} canonical={canonical}>
  <article class="paper article">
    <h1>{fm.catchyTitle}</h1>
    <div class="subhead">{fm.funnySubtitle}</div>
    <div class="byline">{fm.publishedAt.toLocaleDateString()}</div>

    <div class="source">
      Source: <a href={fm.sourceUrl} target="_blank" rel="noopener noreferrer">arXiv</a>
    </div>

    <section class="paper tldr" style="margin-top:14px; padding:14px 14px 12px">
      <h2 style="margin:0 0 8px; font-size:14px; letter-spacing:0.02em; text-transform:uppercase; color:var(--muted)">TL;DR</h2>
      <div style="font-size:15px; line-height:1.5">{fm.tldr}</div>
    </section>

    <div class="tags">
      {fm.tags.map((t) => (
        <a class="tag" href={href(`tags/${encodeURIComponent(t)}/`)}>
          #{t}
        </a>
      ))}
    </div>

    <div style="margin-top:14px">
      <slot />
    </div>

    {related.length ? (
      <section class="related">
        <h3>Related</h3>
        {related.map((r) => (
          <a href={href(`${r.data.arxivId}/${r.slug.split('/').slice(1).join('/')}/`)}>
            <strong>{r.data.catchyTitle}</strong>
            <div style="color:var(--muted); font-size:13px; margin-top:2px">{r.data.blurb}</div>
          </a>
        ))}
      </section>
    ) : null}

    <nav class="pager" aria-label="Previous and next">
      {prev ? (
        <a href={href(`${prev.data.arxivId}/${prev.slug.split('/').slice(1).join('/')}/`)}>
          <div class="label">Previous</div>
          <div class="name">{prev.data.catchyTitle}</div>
        </a>
      ) : (
        <div></div>
      )}

      {next ? (
        <a href={href(`${next.data.arxivId}/${next.slug.split('/').slice(1).join('/')}/`)}>
          <div class="label">Next</div>
          <div class="name">{next.data.catchyTitle}</div>
        </a>
      ) : (
        <div></div>
      )}
    </nav>

    <section class="paper prompts" style="margin-top:14px; padding:14px 14px 12px">
      <h2 style="margin:0 0 10px; font-size:14px; letter-spacing:0.02em; text-transform:uppercase; color:var(--muted)">Copy/paste prompts</h2>
      <div class="promptList">
        {fm.prompts.map((p) => (
          <div class="promptCard">
            <div class="promptTop">
              <div class="promptTitle">{p.title}</div>
              <button class="copyBtn" type="button" data-copy={p.prompt} aria-label={`Copy prompt: ${p.title}`}>
                Copy
              </button>
            </div>
            <pre class="promptPre"><code>{p.prompt}</code></pre>
          </div>
        ))}
      </div>
    </section>
  </article>
</BaseLayout>
