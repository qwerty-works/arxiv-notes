---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { sectionByFeed } from '../../lib/sections';
import { href } from 'astro:assets';

function paperUrl(entry) {
  return href(`${entry.slug}/`);
}

export async function getStaticPaths() {
  const { SECTIONS } = await import('../../lib/sections');
  return SECTIONS.map((s) => ({ params: { feed: s.feed } }));
}

const { feed } = Astro.params;
const section = sectionByFeed(feed);

const papers = (await getCollection('papers'))
  .filter((p) => (p.data.feed ?? 'cs.AI') === feed)
  .slice()
  .sort((a, b) =>
    (b.data.publishedAt.getTime() - a.data.publishedAt.getTime()) ||
    b.data.arxivId.localeCompare(a.data.arxivId)
  );

const title = section ? `${section.label} — Sections` : `${feed} — Sections`;
const desc = section ? `Posts from ${section.label} (${feed})` : `Posts from ${feed}`;
---

<BaseLayout title={title} description={desc}>
  <main class="paper article">
    <h1 style="margin-top:0">{section?.label ?? feed}</h1>
    <p style="color:var(--muted)">
      Feed: <strong>{feed}</strong>
      {section?.sourceUrl ? (
        <>
          <span style="color:var(--muted)"> · </span>
          <a href={section.sourceUrl} target="_blank" rel="noopener noreferrer">arXiv recent</a>
        </>
      ) : null}
    </p>

    <div class="paper list" style="margin-top:14px">
      {papers.length ? (
        papers.map((p) => (
          <a class="cardLink" href={paperUrl(p)}>
            <div class="cardTitle">{p.data.catchyTitle}</div>
            <div class="cardSub">{p.data.blurb}</div>
            <div style="color:var(--muted); font-size:12px; margin-top:6px">
              {p.data.publishedAt.toLocaleDateString()} · arXiv: {p.data.arxivId}
            </div>
          </a>
        ))
      ) : (
        <div style="color:var(--muted)">No posts yet.</div>
      )}
    </div>
  </main>
</BaseLayout>
